# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 项目概述

这是一个使用 HTML5 Canvas 和 JavaScript 实现的经典贪吃蛇游戏。项目结构简单，是纯前端项目，无需构建工具或依赖管理。项目已完成专业视觉优化，从简陋的方块渲染升级为精美的图片素材渲染。

## 核心架构

### 文件结构
- `index.html` - 游戏主页面，包含现代化UI结构和Canvas元素
- `snake.js` - 游戏主逻辑，包含所有游戏功能（已添加详细中文注释）
- `styles.css` - 现代化UI样式表，包含响应式设计和深色主题
- `img/` - 游戏图片资源目录，包含18个精灵图文件
  - `ground.png` - 草地背景图 (608x608px)
  - `food.png` - 苹果食物图 (32x32px)
  - `head_*.png` - 4个方向的蛇头图片 (32x32px each)
  - `body_*.png` - 6种类型的蛇身图片 (32x32px each)  
  - `tail_*.png` - 4个方向的蛇尾图片 (32x32px each)
- `audio/` - 游戏音效文件（移动、吃食物、死亡音效）
- `LICENSE` - MIT开源许可证

### 游戏核心逻辑
- 使用 Canvas 2D 渲染上下文进行绘制
- 游戏循环通过 `setInterval(draw, gameSpeed)` 动态控制刷新频率
- 键盘事件监听处理蛇的移动方向（方向键控制，支持防反向移动）
- 碰撞检测包括边界碰撞和自身碰撞
- 得分系统基于吃到食物的数量
- 最高分记录系统：使用 localStorage 持久化保存最高分
- 游戏控制系统：支持暂停、恢复、重新开始功能
- HUD（抬头显示）系统：实时显示分数、最高分、游戏速度
- 智能图片渲染系统：根据蛇段位置和方向关系选择合适的图片

### 重要的游戏参数
- `box = 32` - 游戏单元格大小（像素）
- 画布尺寸：608x608 像素
- 游戏区域：约 19x19 个单元格
- 初始游戏速度：300ms（每秒约3.33次移动，适中速度）
- 计分区域：通过HUD显示在Canvas外部
- 响应式设计：Canvas 支持移动设备自适应缩放

### 数据结构升级
蛇的数据结构已升级为包含方向信息的对象数组：
```javascript
snake[0] = {
    x: 9 * box,        // x坐标
    y: 10 * box,       // y坐标  
    direction: "RIGHT" // 移动方向，用于选择对应图片
}
```

## 开发指南

### 运行游戏
直接用浏览器打开 `index.html` 即可运行游戏，无需任何构建步骤。

### 代码架构重点

#### 1. 图片资源管理
- 所有图片在页面加载时预加载
- 使用专门的辅助函数选择正确的图片：
  - `getHeadImage(direction)` - 根据方向选择蛇头图片
  - `getTailImage(prevDirection)` - 根据前一节方向选择蛇尾图片  
  - `getBodyImage(prevDirection, currentDirection)` - 根据前后方向选择蛇身图片

#### 2. 智能渲染系统
- 蛇头：根据当前移动方向显示对应朝向
- 蛇身：根据前后节段方向关系选择直线或转弯身体
- 蛇尾：根据前一节方向显示相反朝向的尾巴

#### 3. HUD（抬头显示）系统
- 实时显示游戏数据：当前分数、最高分、游戏速度
- `updateHUD()` 函数负责同步DOM元素内容
- 游戏控制按钮：暂停、恢复、重新开始
- 响应式设计，在移动设备上适当缩放

#### 4. 数据持久化系统
- 使用 localStorage 保存最高分记录
- `bestScore` 变量在游戏初始化时从 localStorage 读取
- 每次游戏结束时自动更新并保存最高分

#### 5. 游戏循环优化
主绘制函数 `draw()` 包含完整的游戏逻辑：
1. 绘制背景
2. 智能绘制蛇（头、身、尾分别处理）
3. 绘制食物
4. 计算下一位置
5. 检测食物碰撞
6. 检测游戏结束
7. 添加新蛇头
8. 更新蛇身数组
9. 更新HUD显示

### 代码修改注意事项

#### 重要函数说明
- `collision(head, array)` - 碰撞检测逻辑
- `direction(event)` - 键盘控制逻辑，包含防反向移动检查
- `draw()` - 主游戏循环，包含所有渲染和逻辑更新
- `updateHUD()` - 更新HUD显示数据
- `pauseGame()` - 暂停游戏（清除定时器）
- `resumeGame()` - 恢复游戏（重新启动定时器）
- `restartGame()` - 重新开始游戏（重置所有游戏状态）
- 图片选择函数 - 核心视觉系统，修改时需要理解方向关系

#### 常见修改场景
- **调整游戏速度**：修改 `gameSpeed` 变量或游戏循环定时器间隔
- **修改游戏区域**：调整边界检测的数值计算
- **添加新图片**：需要更新对应的图片选择函数
- **修改音效**：更新音频文件路径或添加新的音效触发点
- **样式修改**：在 `styles.css` 中调整UI样式
- **HUD修改**：在 `index.html` 中修改HUD结构，在 `updateHUD()` 中同步数据

#### 资源路径管理
- 图片和音频资源路径是硬编码的
- CSS样式使用外部文件，支持CDN字体引入
- 添加新资源时需要：
  1. 放置文件到对应目录
  2. 在代码顶部加载资源（图片/音频）
  3. 在相应函数中添加选择逻辑
  4. 样式资源直接在CSS文件中修改

### 已完成的优化项目
1. ✅ 视觉系统升级 - 从方块渲染升级为专业图片渲染
2. ✅ 数据结构增强 - 蛇节添加方向属性
3. ✅ 智能图片选择 - 根据上下文自动选择合适图片
4. ✅ 游戏速度调优 - 调整为更适合的300ms间隔
5. ✅ 代码注释完善 - 添加详细的中文注释
6. ✅ 暂停/恢复功能 - 支持游戏暂停和恢复
7. ✅ 最高分记录功能 - 使用 localStorage 持久化保存
8. ✅ 现代化UI设计 - 深色主题，渐变效果，响应式布局
9. ✅ HUD系统 - 实时显示游戏数据的抬头显示
10. ✅ 移动端适配 - Canvas响应式缩放，适配小屏幕设备

### 潜在改进方向
- 动态难度调整（随分数增加速度）
- 移动端触控支持（滑动手势控制）
- 键盘输入优化（支持WASD键）
- 更多视觉效果（动画、粒子效果）
- 音效音量控制
- 游戏菜单界面和设置页面
- 多种游戏模式（经典模式、挑战模式等）
- 蛇的皮肤系统（不同颜色/样式选择）
- 游戏统计功能（游戏次数、平均分数等）